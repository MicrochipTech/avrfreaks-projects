
.DEF	PCF=R15 ;PROGRAM CONTROL FLAGS. THIS IS A GLOBAL REGISTER, SO DON'T USE IT IN OTHER PURPOSES!
.EQU	__Sched_TICK=0

.DEF	TEMP=R16 ;TEMPORARY REGISTER

.EQU	__MAX_ScTask=5

.EQU	__ScTASK_FREE=0
.EQU	__ScTASK_DIS=1
.EQU	__ScTASK_EN=2
.EQU	__ScTASK_RUN=3


;***********************************************************************
; CREATE Scheduled Task
;***********************************************************************

.MACRO	_CREATE_ScTask 
;@0: ScTask NO.	8BIT
;@1: PRESET_VALUE	16BIT
;@2: MASK  SINGLE BIT( ScTask STATUS)
;@3: FUN ADDRESS  16BIT
	LDI		ZH,HIGH(@3)
	LDI		ZL,LOW(@3)
	LDI		YH,HIGH(RAM_ScTASK+(@0*7))
	LDI		YL,LOW(RAM_ScTASK+(@0*7))
	LDI		XH,HIGH(@1)
	LDI		XL,LOW(@1)
	LDI		R17,@2
	CALL	INIT_SCTASK

.ENDMACRO

.MACRO	_DELETE_ScTask
	LDI		YH,HIGH(RAM_ScTASK+(@0*7))
	LDI		YL,LOW(RAM_ScTASK+(@0*7))	
	CALL	DELETE_SCTASK
.ENDMACRO

.MACRO	_RESET_ScTask
	LDI		YH,HIGH(RAM_ScTASK+(@0*7)+3)
	LDI		YL,LOW(RAM_ScTASK+(@0*7)+3)	
	CALL	RESET_SCTASK
.ENDMACRO


.MACRO	_SET_ScTask
	LDI		YH,HIGH(RAM_ScTASK+(@0*7)+1)
	LDI		YL,LOW(RAM_ScTASK+(@0*7)+1)
	LDI		XH,HIGH(@1)
	LDI		XL,LOW(@1)	
	CALL	SET_SCTASK
.ENDMACRO


.MACRO _ENABLE_ScTask
	LDI		YH,HIGH(RAM_ScTASK+(@0*7))
	LDI		YL,LOW(RAM_ScTASK+(@0*7))	
	CALL	ENABLE_SCTASK	
.ENDMACRO

.MACRO _DISABLE_ScTask
	LDI		YH,HIGH(RAM_ScTASK+(@0*7))
	LDI		YL,LOW(RAM_ScTASK+(@0*7))	
	CALL	DISABLE_SCTASK
.ENDMACRO

.MACRO _CBR ; Register,Bit#
		CLT
		BLD		@0,@1
.ENDMACRO

.MACRO _SBR ; Register,Bit#
		SET
		BLD 	@0,@1
.ENDMACRO


.MACRO  _IF_BIT_SET_RCALL
    SBRC    @0,@1        
    RCALL    @2

.ENDMACRO
.DSEG
;EACH Sched.TASK HAS A STRUCTURE, USES 7BYTES OF SRAM 
RAM_ScTASK:				.BYTE	__MAX_ScTask*7		
;
;*** ScTask STRUCTURE ***
;RAM_ScTask0_STATUS:		.BYTE	1 --Sched.TASK STATUS(RUN,ENABLE,DISABLE)
;RAM_ScTask0_CV:			.BYTE	2 --Sched.TASK CURRENT VALUE
;RAM_ScTask0_PV:			.BYTE	2 --Sched.TASK PRESET VALUE
;RAM_ScTask0_FUN:			.BYTE	2 --Sched.TASK FUNCTION ADDRESS. THIS IS A POINTER TO A FUNCTION
