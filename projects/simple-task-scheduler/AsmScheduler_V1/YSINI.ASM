

SYSTEM_INI:


; STACK INITIATION 
	LDI		ZH,HIGH(RAMEND)
	OUT		SPH,ZH
	LDI		ZL,LOW(RAMEND)
	OUT		SPL,ZL

	LDI		TEMP,$FF
	OUT		DDRB,TEMP
	LDI		TEMP,0B00000001 ;PB.0 WILL BE TOGGLE EACH10mS AFTER THE FIRST 100mS OF PROGRAM



;************************************************************************************************************
;*
;* TASK CREATION
;*
;* U CAN CREATE ScTASKs BY USING THE _CREATE_ScTASK MACRO.
;* FOR 10 ScTASKs(ALL IN ENABLE STATUS) IT TAKES 18uS(16MHz CLOCK)
;* TO CHECK ALL TASKS IN TIMER INTERRUPT.
;*
;* _CREATE_ScTask	ScTASK_NUMBER,EXECUTION_INTERVAL,ScTASK_STATUS(ENABLED,DISABLED,RUN),POINTER TO FUNCTION	
;*
;* U CAN ReUSE A ScTASK,VERY EASY.JUST CHANGE THE ADDRESS POINTER AND STATUS OF THE TASK.
;*	
;* __MAX_ScTASK DEFINED IN Sched.INC USED TO DEFINE NUMBER OF TASK IN PROCESS.THE LOWER TASK NUMBER,
;* CAUSE THE LOWER TIMER1_INTERRUPT'S OVERHEAD.
;*
;*	ALL ScTASK HAS A 16BIT CURRENT-VALUE AND A 16BIT PRESET-VALUE.	
;***********************************************************************************************************

	_CREATE_ScTask  0,100,(__ScTASK_EN),SYSTEM_START ;CREATES SCHEDULED TASK#0.THIS TASK IS 
	;THE FIRST TASK IN THE TASK-QUEUE.THIS TASK WILL EXECUTE AFTER 100*(__SCHED_TICK)-(IN THIS PROGRAM-
	;EACH __SCHED_TICK=1mS. SYSTEM_SATART FAUNCTION DISABLES THE ScTask0 AND ENABLES THE ScTask1.


	_CREATE_ScTask  1,10,(__ScTASK_DIS),TOGGLE_PORTB ;CREATES SCHEDULED TASK#1.THIS TASK IS 
	;THE SECOND TASK IN THE TASK-QUEUE.IF THIS TASK BE IN ENABLE MODE IT WILL BE EXECUTED EACH 
	;EACH 10*(__SCHED_TICK) AND WILL EXECUTE THE TOGGLE_PORTB FUNCTION.

	_CREATE_ScTask  2,1000,(__ScTASK_DIS),SECOND_TICK ;CREATES SCHEDULED TASK#2.THIS TASK IS 
	;THE THIRD TASK IN THE TASK-QUEUE.IF THIS TASK BE IN ENABLE MODE IT WILL BE EXECUTED EACH 
	;EACH 1000*(__SCHED_TICK) -(EACH 1 SECOND IN THIS PROGRAM) 

	_CREATE_ScTask  3,60000,(__ScTASK_DIS),MINUTE_TICK ;CREATES SCHEDULED TASK#3.THIS TASK IS 
	;THE 4Th TASK IN THE TASK-QUEUE.IF THIS TASK BE IN ENABLE MODE IT WILL BE EXECUTED EACH 
	;EACH 60000*(__SCHED_TICK) -(EACH 1 MINUTE IN THIS PROGRAM) 




;	16BIT TIMER1 USED TO GENERATE THE SCHEDULER_TICK.
;	USING OF OF 16BIT TIMER1 WITH NO PRESCALER HAS THE MINIMUM ERROR IN TASK TIMING.
    LDI 	TEMP,LOW(16000-1) 
	LDI		R17,HIGH(16000-1)
    OUT 	OCR1AH,R17  ;*LOADS TIMER1 FOR 1 ms 
	OUT		OCR1AL,TEMP
	LDI 	TEMP,(1<<WGM12)|(1<<CS10)	; MODE4:CTC	 TIMER1 AUTOMATICALY CLEARED AFRTER OVERFLOW		
	OUT 	TCCR1B,TEMP
    LDI		TEMP,(1<<OCIE1A)
	OUT 	TIMSK,TEMP	
	SEI

	RJMP	MAIN
