/*
   Init.c

   GSM_ControlSystem "GSA" V1.0.0  Copyright (C) 2012 Easy System


    ****************************************************************************
    *    >>> See http://www.esyste.com for Hw Documentation <<<					*
    *                                                                           *
    *    Thank you for using GSA, and thank you for your support!               *
    *                                                                           *
    ****************************************************************************
    see header file for details
*/
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#include <avr/io.h>
#include <avr/eeprom.h>
#include <avr/interrupt.h>
#include <string.h>
#include <stdlib.h>
#include <stdbool.h>
//*******************************************************************************************
#include "Init.h"
#include "ISR_Uart.h"
#include "DefineIO.h"
#include "a2d.h"
//*******************************************************************************************

// Write to the programmer at this location the value
//calibration of the oscillator.
//#define FIXED_LOCATION 0x1000

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// extern functions

void vPD7_Interrupt_init( void );
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void  prvSetupHardware (void)
{

 //Disable pullup
 MCUCR |= _BV(PUD);

 // output
 DDRB  = 0xFF;
 DDRC |= ( _BV(O_Led) | _BV(O_GsmReset) | _BV(O_GsmOnOff) );
 DDRD |= _BV(O_GsmRTS);


 //calibration of the oscillator.
/*
    Tmp = eeprom_read_byte((unsigned char *)FIXED_LOCATION);

  OSCCAL = Tmp;
*/

  //initialize ADC
  a2dInit();

  //UART : UBRR = F_CPU/(16*BAUD) -1
  xUartInit((F_CPU/BAUD_RATE)/16 -1);

  //PD7 interrupt init
  vPD7_Interrupt_init();

/*
Enable Reset to power < 2.7V
Done in the FUSE
*/

}
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

