	/*
   ISR_PinD7_Int.c

   GSM_ControlSystem "GSA" V1.0.0  Copyright (C) 2012 Easy System

    *********************************************************************************
    *    >>> See http://www.esyste.com for Hw Documentation <<<						*
    *																				*
    *    Thank you for using GSA, and thank you for your support!					*
    *																				*
    *********************************************************************************
    see header file for details
*/
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#include <avr/io.h>
#include <avr/interrupt.h>
#include <stdlib.h>
#include <string.h>

#include "ISR_Uart.h"
#include "Define.h"
#include "FreeRTOS.h"

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// External Global Variables
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
volatile extern uint8_t StatusFlags;

//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
/*************************************************************************
Function: vPD7_Interrupt_init()
Purpose:  initialize Interrupt when PD7 change status
Input:    none
Returns:  none
**************************************************************************/
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void vPD7_Interrupt_init( void )
{

	StatusFlags &= ~SIM_INSERTED;

	PCICR = _BV(PCIE3);	//enable pcie3 interrupt (for PCINT31..24 inputs)
	//PCIF3 bit of PCIFR register goes 1 when PCINT31..24 inputs change and PCIE3 is set

	PCMSK3 = _BV(PCINT31);  //| _BV(PCINT29);	// enable interrupt for PCINT31 = GsmCard Inserted and not PCINT29 to detect power

	//with this any changes  of PIND7 generate an interrupt

}
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
/*************************************************************************
Function: PIND7  interrupt
Purpose:  called when PIND7 change
**************************************************************************/
ISR( PCINT3_vect )
{
	//SIM INSERTED or not
	if( PIND & _BV(I_GsmSimNotInserted) )
		StatusFlags &= ~SIM_INSERTED;
	else
		StatusFlags |= SIM_INSERTED;

}
//-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
