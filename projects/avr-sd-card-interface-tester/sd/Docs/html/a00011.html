<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AVR SD Interface: sd.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>sd.c File Reference</h1>SD SPI interface.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;inttypes.h&gt;</code><br>
<code>#include &lt;avr/sfr_defs.h&gt;</code><br>
<code>#include &lt;avr/io.h&gt;</code><br>
<code>#include &lt;avr/interrupt.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &quot;<a class="el" href="a00029.html">sd.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00031.html">spi.h</a>&quot;</code><br>
<code>#include &quot;utils.h&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for sd.c:</div>
<div class="dynsection">
<p><center><img src="a00045.png" border="0" usemap="#sd.c_map" alt=""></center>
<map name="sd.c_map">
<area shape="rect" id="node13" href="a00012.html" title="SD SPI interface header." alt="" coords="581,83,629,112"><area shape="rect" id="node15" href="a00014.html" title="SPI interface header." alt="" coords="653,83,704,112"><area shape="rect" id="node17" href="a00035.html" title="utils.h" alt="" coords="728,83,789,112"></map>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="322e7d77822e29ed8b6ec313cc027cd9"></a><!-- doxytag: member="sd.c::SD_USE_CRC" ref="322e7d77822e29ed8b6ec313cc027cd9" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>SD_USE_CRC</b></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e3dd15ec52cbd1ef2ce6e20e39fd6efb"></a><!-- doxytag: member="sd.c::CMD_GO_IDLE_STATE" ref="e3dd15ec52cbd1ef2ce6e20e39fd6efb" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_GO_IDLE_STATE</b>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e059745768a7fde0832a1dea6a623ab0"></a><!-- doxytag: member="sd.c::CMD_SEND_OP_COND" ref="e059745768a7fde0832a1dea6a623ab0" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_SEND_OP_COND</b>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="773735b7bef10597c3db4f8a60e42ad3"></a><!-- doxytag: member="sd.c::CMD_SEND_IF_COND" ref="773735b7bef10597c3db4f8a60e42ad3" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_SEND_IF_COND</b>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="039c816f90fba6c89d09980c5c1cb888"></a><!-- doxytag: member="sd.c::CMD_SEND_CSD" ref="039c816f90fba6c89d09980c5c1cb888" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_SEND_CSD</b>&nbsp;&nbsp;&nbsp;9</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="69e5cfa724af0af3e97d69005a2b588d"></a><!-- doxytag: member="sd.c::CMD_SEND_CID" ref="69e5cfa724af0af3e97d69005a2b588d" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_SEND_CID</b>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d78a2aaecc9a9897f7da971d81e3785a"></a><!-- doxytag: member="sd.c::CMD_STOP_TRANSMISSION" ref="d78a2aaecc9a9897f7da971d81e3785a" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_STOP_TRANSMISSION</b>&nbsp;&nbsp;&nbsp;12</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="fc227f5ab9e89ace42c1416fa095f8aa"></a><!-- doxytag: member="sd.c::CMD_SEND_STATUS" ref="fc227f5ab9e89ace42c1416fa095f8aa" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_SEND_STATUS</b>&nbsp;&nbsp;&nbsp;13</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="cc98caadb00bb27cee9c6037193adb68"></a><!-- doxytag: member="sd.c::CMD_SET_BLOCKLEN" ref="cc98caadb00bb27cee9c6037193adb68" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_SET_BLOCKLEN</b>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="bfe445b381f51fa7f4aaaa74c6184c31"></a><!-- doxytag: member="sd.c::CMD_READ_BLOCK" ref="bfe445b381f51fa7f4aaaa74c6184c31" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_READ_BLOCK</b>&nbsp;&nbsp;&nbsp;17</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a80d29db85713b1fffcf39b37d67e69b"></a><!-- doxytag: member="sd.c::CMD_WRITE_BLOCK" ref="a80d29db85713b1fffcf39b37d67e69b" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_WRITE_BLOCK</b>&nbsp;&nbsp;&nbsp;24</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="2e1d803a81add9a4f5254f06b5795834"></a><!-- doxytag: member="sd.c::CMD_ERASE_BLOCK_START" ref="2e1d803a81add9a4f5254f06b5795834" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_ERASE_BLOCK_START</b>&nbsp;&nbsp;&nbsp;32</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="1292e676d8d4831731fa808f43f3175e"></a><!-- doxytag: member="sd.c::CMD_ERASE_BLOCK_END" ref="1292e676d8d4831731fa808f43f3175e" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_ERASE_BLOCK_END</b>&nbsp;&nbsp;&nbsp;33</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="73d541696536a935eec42edc03359e96"></a><!-- doxytag: member="sd.c::CMD_ERASE" ref="73d541696536a935eec42edc03359e96" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_ERASE</b>&nbsp;&nbsp;&nbsp;38</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5625571f0a42246f009e1695f5c0fd88"></a><!-- doxytag: member="sd.c::CMD_READ_OCR" ref="5625571f0a42246f009e1695f5c0fd88" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_READ_OCR</b>&nbsp;&nbsp;&nbsp;58</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="fb5d8ee662bb31ad2821f5321ea4e72a"></a><!-- doxytag: member="sd.c::CMD_CRC_ONOFF" ref="fb5d8ee662bb31ad2821f5321ea4e72a" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_CRC_ONOFF</b>&nbsp;&nbsp;&nbsp;59</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="cdb057504ceebb40cb4a5df3197a8fb5"></a><!-- doxytag: member="sd.c::APP_CMD" ref="cdb057504ceebb40cb4a5df3197a8fb5" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>APP_CMD</b>&nbsp;&nbsp;&nbsp;55</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="38e73c548131f1fd3f8acdad82fd44fb"></a><!-- doxytag: member="sd.c::SD_SEND_OP_COND" ref="38e73c548131f1fd3f8acdad82fd44fb" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>SD_SEND_OP_COND</b>&nbsp;&nbsp;&nbsp;41</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="dee7c13eaeccaf3a5e695387c1715ce7"></a><!-- doxytag: member="sd.c::R1_IDLE" ref="dee7c13eaeccaf3a5e695387c1715ce7" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>R1_IDLE</b>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4598fdd1bd123e39ca45cdcd30f2a0bb"></a><!-- doxytag: member="sd.c::R1_ERASE_RESET" ref="4598fdd1bd123e39ca45cdcd30f2a0bb" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>R1_ERASE_RESET</b>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="20c1db50084f3de0e58aee0be61c82a8"></a><!-- doxytag: member="sd.c::R1_ILLEGAL_CMD" ref="20c1db50084f3de0e58aee0be61c82a8" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>R1_ILLEGAL_CMD</b>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b65aca3ffa8444c4f7d3892c3d1a9d5f"></a><!-- doxytag: member="sd.c::R1_CRC_ERROR" ref="b65aca3ffa8444c4f7d3892c3d1a9d5f" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>R1_CRC_ERROR</b>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="20d5ba3f7c05955be378cbcef5d1b452"></a><!-- doxytag: member="sd.c::R1_ERASE_ERROR" ref="20d5ba3f7c05955be378cbcef5d1b452" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>R1_ERASE_ERROR</b>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b7a9e062c9bcb3ef8d9d909a4abbe4b7"></a><!-- doxytag: member="sd.c::R1_ADDR_ERROR" ref="b7a9e062c9bcb3ef8d9d909a4abbe4b7" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>R1_ADDR_ERROR</b>&nbsp;&nbsp;&nbsp;0x20</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="31f08587a1525ee3725c60d69e40bbb8"></a><!-- doxytag: member="sd.c::R1_PARAM_ERROR" ref="31f08587a1525ee3725c60d69e40bbb8" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>R1_PARAM_ERROR</b>&nbsp;&nbsp;&nbsp;0x40</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5f137187c6a892935c5acd036f609b22"></a><!-- doxytag: member="sd.c::NO_RESPONSE" ref="5f137187c6a892935c5acd036f609b22" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>NO_RESPONSE</b>&nbsp;&nbsp;&nbsp;0xFF</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d51ded0bbd705f02f73fc60c0b721ced"></a><!-- doxytag: member="sd.c::BLOCK_SIZE" ref="d51ded0bbd705f02f73fc60c0b721ced" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>BLOCK_SIZE</b>&nbsp;&nbsp;&nbsp;512</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ed747105ccaf2d97d28348011a53bde9"></a><!-- doxytag: member="sd.c::FILL_BYTE" ref="ed747105ccaf2d97d28348011a53bde9" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>FILL_BYTE</b>&nbsp;&nbsp;&nbsp;0xFF</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3f2e01a09cd6ec5fa9babf6cd3ba8f79"></a><!-- doxytag: member="sd.c::START_BLOCK" ref="3f2e01a09cd6ec5fa9babf6cd3ba8f79" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>START_BLOCK</b>&nbsp;&nbsp;&nbsp;0xFE</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5e4732ff0ea175b06d3d2f2ae9905e02"></a><!-- doxytag: member="sd.c::CMD_BYTE_LENGTH" ref="5e4732ff0ea175b06d3d2f2ae9905e02" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CMD_BYTE_LENGTH</b>&nbsp;&nbsp;&nbsp;6</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="917c2f59272ac3db92f06f84f87fbf35"></a><!-- doxytag: member="sd.c::CRC16_POLYN" ref="917c2f59272ac3db92f06f84f87fbf35" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>CRC16_POLYN</b>&nbsp;&nbsp;&nbsp;0x1021</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#7a31f8cd5e4ddd7afed33f08de2c4f15">SD_DelayBytes</a> (uint16_t bytes)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Clocks out on the SPI line.  <a href="#7a31f8cd5e4ddd7afed33f08de2c4f15"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#e6f6814ebced9e1eccdce5dbece62cd0">SD_SendCommand</a> (uint8_t command, uint32_t arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends a command to the card.  <a href="#e6f6814ebced9e1eccdce5dbece62cd0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#6adf6824b8f4566ddd4d3965c6e86d6e">SD_CheckForCard</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks for the presence of a card.  <a href="#6adf6824b8f4566ddd4d3965c6e86d6e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#dc0158e94a600dc3b63be4d83c561fb3">SD_GetResponse</a> (uint8_t *buf, uint16_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reads a response from the SD card.  <a href="#dc0158e94a600dc3b63be4d83c561fb3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#c9fb3c9ff54cfbffe7c4babe9d3bc6ee">SD_ReadData</a> (uint8_t *buf, uint16_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reads a data response of a given length.  <a href="#c9fb3c9ff54cfbffe7c4babe9d3bc6ee"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#d702de6e3d8967fc351bf7bab00b1d41">SD_DecodeR1</a> (uint8_t res)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Decodes the R1 response type.  <a href="#d702de6e3d8967fc351bf7bab00b1d41"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#6ce33f8b0dfdecdd04ed9e1395c36d46">SD_DecodeDataRes</a> (uint8_t res)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Decodes the R2 response type.  <a href="#6ce33f8b0dfdecdd04ed9e1395c36d46"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#e03df3cb7531a9d176313802115f937a">SD_DecodeDataErr</a> (uint8_t res)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Decodes the data error response.  <a href="#e03df3cb7531a9d176313802115f937a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#2b9a7db31f5fb14b84ce4297aba9d99b">SD_CRC7</a> (uint8_t *bytes, uint32_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A simple CRC7 calculation.  <a href="#2b9a7db31f5fb14b84ce4297aba9d99b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#519ad77971f09364599528c59e108b59">SD_CRC16</a> (uint8_t *bytes, uint32_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A simple CRC16 calculation (Xmodem).  <a href="#519ad77971f09364599528c59e108b59"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#ae571a1a29dbeeb9a79cae35d7a62de5">SD_CRC16_Fill</a> (uint16_t crc, uint8_t const_value, uint32_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Continues a CRC16 (Xmodem) check.  <a href="#ae571a1a29dbeeb9a79cae35d7a62de5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#a7a6e00a7867366345f8ba72c5fa58c5">SD_Init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the SD card.  <a href="#a7a6e00a7867366345f8ba72c5fa58c5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#d536c2272a315395f9e4cf1f7e153620">SD_ReadBlock</a> (uint8_t *buf, uint32_t addr, uint16_t size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read a block of data from the SD card.  <a href="#d536c2272a315395f9e4cf1f7e153620"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#4e692b3a2d4421d0d7ff2782eac528c5">SD_WriteBlock</a> (uint8_t *data, uint32_t addr, uint16_t size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Writes a block of data to the SD card.  <a href="#4e692b3a2d4421d0d7ff2782eac528c5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00011.html#3c2a169297f1c0eb348a950ce0288687">SD_EraseBlock</a> (uint32_t addr, uint32_t size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Erases a block of data from the SD card.  <a href="#3c2a169297f1c0eb348a950ce0288687"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="1a4c6adc98fd729b603cf07e2441dec1"></a><!-- doxytag: member="sd.c::scratch" ref="1a4c6adc98fd729b603cf07e2441dec1" args="[32]" -->
static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><b>scratch</b> [32]</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
SD SPI interface. 
<p>
A simple SD interface using SPI. This relies on the associated SPI interface, but should be relatively simple to recreate.<p>
This interface is somewhat bloated. It is not intended to be fast, but instead helpful for debugging and learning. <hr><h2>Function Documentation</h2>
<a class="anchor" name="6adf6824b8f4566ddd4d3965c6e86d6e"></a><!-- doxytag: member="sd.c::SD_CheckForCard" ref="6adf6824b8f4566ddd4d3965c6e86d6e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_CheckForCard           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks for the presence of a card. 
<p>
Issues CMD_GO_IDLE_STATE 10 times or until a response is received.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if card is found, 0 otherwise </dd></dl>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="a00011_6adf6824b8f4566ddd4d3965c6e86d6e_cgraph.png" border="0" usemap="#a00011_6adf6824b8f4566ddd4d3965c6e86d6e_cgraph_map" alt=""></center>
<map name="a00011_6adf6824b8f4566ddd4d3965c6e86d6e_cgraph_map">
<area shape="rect" id="node3" href="a00011.html#dc0158e94a600dc3b63be4d83c561fb3" title="Reads a response from the SD card." alt="" coords="200,46,339,75"><area shape="rect" id="node11" href="a00011.html#e6f6814ebced9e1eccdce5dbece62cd0" title="Sends a command to the card." alt="" coords="196,124,343,154"><area shape="rect" id="node5" href="a00013.html#05039575653a077fb25a28c31d583243" title="Deassert CS." alt="" coords="409,32,495,62"><area shape="rect" id="node7" href="a00013.html#8ddc120b2a7fc96d17e0bd9f157a94eb" title="Assert CS." alt="" coords="411,86,493,115"><area shape="rect" id="node9" href="a00013.html#a14a3a4150662024315e78864403ff5f" title="Tx/Rx a byte." alt="" coords="560,138,664,167"><area shape="rect" id="node13" href="a00011.html#2b9a7db31f5fb14b84ce4297aba9d99b" title="A simple CRC7 calculation." alt="" coords="409,243,495,272"><area shape="rect" id="node15" href="a00013.html#a71812ceda81f6abdee26dda53868fdd" title="Send a block of data over the SPI." alt="" coords="393,190,511,219"></map>
</div>

</div>
</div><p>
<a class="anchor" name="519ad77971f09364599528c59e108b59"></a><!-- doxytag: member="sd.c::SD_CRC16" ref="519ad77971f09364599528c59e108b59" args="(uint8_t *bytes, uint32_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t SD_CRC16           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
A simple CRC16 calculation (Xmodem). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bytes</em>&nbsp;</td><td>a pointer to the source data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the length of the source data (32bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the resultant CRC (16bit) </dd></dl>

</div>
</div><p>
<a class="anchor" name="ae571a1a29dbeeb9a79cae35d7a62de5"></a><!-- doxytag: member="sd.c::SD_CRC16_Fill" ref="ae571a1a29dbeeb9a79cae35d7a62de5" args="(uint16_t crc, uint8_t const_value, uint32_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t SD_CRC16_Fill           </td>
          <td>(</td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>crc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>const_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Continues a CRC16 (Xmodem) check. 
<p>
Allows you to calculate the crc for a constant stream of bytes.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>crc</em>&nbsp;</td><td>the starting CRC </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>const_value</em>&nbsp;</td><td>the constant byte to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the number of bytes to run through the CRC</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the resultant CRC (16bit) </dd></dl>

</div>
</div><p>
<a class="anchor" name="2b9a7db31f5fb14b84ce4297aba9d99b"></a><!-- doxytag: member="sd.c::SD_CRC7" ref="2b9a7db31f5fb14b84ce4297aba9d99b" args="(uint8_t *bytes, uint32_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_CRC7           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
A simple CRC7 calculation. 
<p>
CRC7 function, stolen from some SHARP docs, which stole it from some Siemens docs...<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bytes</em>&nbsp;</td><td>a pointer to the source data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the length of the source data (32bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the resultant CRC (8bit) </dd></dl>

</div>
</div><p>
<a class="anchor" name="e03df3cb7531a9d176313802115f937a"></a><!-- doxytag: member="sd.c::SD_DecodeDataErr" ref="e03df3cb7531a9d176313802115f937a" args="(uint8_t res)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_DecodeDataErr           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>res</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Decodes the data error response. 
<p>
Decodes the data error response and prints out an error message, if applicable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>the data error response </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="6ce33f8b0dfdecdd04ed9e1395c36d46"></a><!-- doxytag: member="sd.c::SD_DecodeDataRes" ref="6ce33f8b0dfdecdd04ed9e1395c36d46" args="(uint8_t res)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_DecodeDataRes           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>res</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Decodes the R2 response type. 
<p>
Decodes the R2 response and prints out an error message, if applicable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>the R2 response Decodes the data response Decodes the data response and prints out an error message, if applicable.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>the data response </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="d702de6e3d8967fc351bf7bab00b1d41"></a><!-- doxytag: member="sd.c::SD_DecodeR1" ref="d702de6e3d8967fc351bf7bab00b1d41" args="(uint8_t res)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_DecodeR1           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>res</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Decodes the R1 response type. 
<p>
Decodes the R1 response and prints out an error message, if applicable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>the R1 response </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="7a31f8cd5e4ddd7afed33f08de2c4f15"></a><!-- doxytag: member="sd.c::SD_DelayBytes" ref="7a31f8cd5e4ddd7afed33f08de2c4f15" args="(uint16_t bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_DelayBytes           </td>
          <td>(</td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>bytes</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Clocks out on the SPI line. 
<p>
Sends 0xFF over the SPI line as a way to feed the SD card a clock with no data.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bytes</em>&nbsp;</td><td>the number of bytes to clock out (16bit) </td></tr>
  </table>
</dl>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="a00011_7a31f8cd5e4ddd7afed33f08de2c4f15_cgraph.png" border="0" usemap="#a00011_7a31f8cd5e4ddd7afed33f08de2c4f15_cgraph_map" alt=""></center>
<map name="a00011_7a31f8cd5e4ddd7afed33f08de2c4f15_cgraph_map">
<area shape="rect" id="node3" href="a00013.html#a14a3a4150662024315e78864403ff5f" title="Tx/Rx a byte." alt="" coords="181,5,285,35"></map>
</div>

</div>
</div><p>
<a class="anchor" name="3c2a169297f1c0eb348a950ce0288687"></a><!-- doxytag: member="sd.c::SD_EraseBlock" ref="3c2a169297f1c0eb348a950ce0288687" args="(uint32_t addr, uint32_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_EraseBlock           </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Erases a block of data from the SD card. 
<p>
Erases data starting at addr and ending at addr+size (inclusive). The SD card will erase all 512byte blocks that the range touches.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>the 32bit start address </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>the size of the block to erase (32bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise </dd></dl>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="a00011_3c2a169297f1c0eb348a950ce0288687_cgraph.png" border="0" usemap="#a00011_3c2a169297f1c0eb348a950ce0288687_cgraph_map" alt=""></center>
<map name="a00011_3c2a169297f1c0eb348a950ce0288687_cgraph_map">
<area shape="rect" id="node3" href="a00011.html#d702de6e3d8967fc351bf7bab00b1d41" title="Decodes the R1 response type." alt="" coords="192,5,309,35"><area shape="rect" id="node5" href="a00011.html#dc0158e94a600dc3b63be4d83c561fb3" title="Reads a response from the SD card." alt="" coords="181,59,320,88"><area shape="rect" id="node7" href="a00013.html#05039575653a077fb25a28c31d583243" title="Deassert CS." alt="" coords="391,107,476,136"><area shape="rect" id="node9" href="a00013.html#8ddc120b2a7fc96d17e0bd9f157a94eb" title="Assert CS." alt="" coords="392,160,475,189"><area shape="rect" id="node11" href="a00013.html#a14a3a4150662024315e78864403ff5f" title="Tx/Rx a byte." alt="" coords="541,267,645,296"><area shape="rect" id="node13" href="a00011.html#e6f6814ebced9e1eccdce5dbece62cd0" title="Sends a command to the card." alt="" coords="177,213,324,243"><area shape="rect" id="node15" href="a00011.html#2b9a7db31f5fb14b84ce4297aba9d99b" title="A simple CRC7 calculation." alt="" coords="391,267,476,296"><area shape="rect" id="node17" href="a00013.html#a71812ceda81f6abdee26dda53868fdd" title="Send a block of data over the SPI." alt="" coords="375,213,492,243"></map>
</div>

</div>
</div><p>
<a class="anchor" name="dc0158e94a600dc3b63be4d83c561fb3"></a><!-- doxytag: member="sd.c::SD_GetResponse" ref="dc0158e94a600dc3b63be4d83c561fb3" args="(uint8_t *buf, uint16_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_GetResponse           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reads a response from the SD card. 
<p>
Reads a response of a given length into the specified buffer. The entire response is loaded in the provided buffer, and the first byte is duplicated as the return value<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>a pointer to the destination buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the number of bytes to read as the response (16bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the first byte of the response </dd></dl>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="a00011_dc0158e94a600dc3b63be4d83c561fb3_cgraph.png" border="0" usemap="#a00011_dc0158e94a600dc3b63be4d83c561fb3_cgraph_map" alt=""></center>
<map name="a00011_dc0158e94a600dc3b63be4d83c561fb3_cgraph_map">
<area shape="rect" id="node3" href="a00013.html#05039575653a077fb25a28c31d583243" title="Deassert CS." alt="" coords="204,5,289,35"><area shape="rect" id="node5" href="a00013.html#8ddc120b2a7fc96d17e0bd9f157a94eb" title="Assert CS." alt="" coords="205,59,288,88"><area shape="rect" id="node7" href="a00013.html#a14a3a4150662024315e78864403ff5f" title="Tx/Rx a byte." alt="" coords="195,112,299,141"></map>
</div>

</div>
</div><p>
<a class="anchor" name="a7a6e00a7867366345f8ba72c5fa58c5"></a><!-- doxytag: member="sd.c::SD_Init" ref="a7a6e00a7867366345f8ba72c5fa58c5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_Init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize the SD card. 
<p>
Attempts to initialize an SD card on the SPI bus. Will go through the standard initialization procedures, and then print out the CID and CSD in hex.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise </dd></dl>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="a00011_a7a6e00a7867366345f8ba72c5fa58c5_cgraph.png" border="0" usemap="#a00011_a7a6e00a7867366345f8ba72c5fa58c5_cgraph_map" alt=""></center>
<map name="a00011_a7a6e00a7867366345f8ba72c5fa58c5_cgraph_map">
<area shape="rect" id="node3" href="a00017.html#db1638ef5bc4018185fa1d9e5c68097d" title="Prints a bunch of hex." alt="" coords="152,41,235,70"><area shape="rect" id="node5" href="a00011.html#6adf6824b8f4566ddd4d3965c6e86d6e" title="Checks for the presence of a card." alt="" coords="123,145,264,174"><area shape="rect" id="node7" href="a00011.html#dc0158e94a600dc3b63be4d83c561fb3" title="Reads a response from the SD card." alt="" coords="317,194,456,224"><area shape="rect" id="node9" href="a00013.html#05039575653a077fb25a28c31d583243" title="Deassert CS." alt="" coords="544,248,629,277"><area shape="rect" id="node15" href="a00011.html#e6f6814ebced9e1eccdce5dbece62cd0" title="Sends a command to the card." alt="" coords="313,93,460,122"><area shape="rect" id="node25" href="a00011.html#d702de6e3d8967fc351bf7bab00b1d41" title="Decodes the R1 response type." alt="" coords="135,401,252,430"><area shape="rect" id="node27" href="a00011.html#7a31f8cd5e4ddd7afed33f08de2c4f15" title="Clocks out on the SPI line." alt="" coords="323,378,451,408"><area shape="rect" id="node31" href="a00011.html#c9fb3c9ff54cfbffe7c4babe9d3bc6ee" title="Reads a data response of a given length." alt="" coords="329,300,444,329"><area shape="rect" id="node11" href="a00013.html#8ddc120b2a7fc96d17e0bd9f157a94eb" title="Assert CS." alt="" coords="545,194,628,224"><area shape="rect" id="node13" href="a00013.html#a14a3a4150662024315e78864403ff5f" title="Tx/Rx a byte." alt="" coords="712,142,816,172"><area shape="rect" id="node17" href="a00011.html#2b9a7db31f5fb14b84ce4297aba9d99b" title="A simple CRC7 calculation." alt="" coords="544,37,629,66"><area shape="rect" id="node19" href="a00013.html#a71812ceda81f6abdee26dda53868fdd" title="Send a block of data over the SPI." alt="" coords="528,90,645,120"><area shape="rect" id="node33" href="a00011.html#e03df3cb7531a9d176313802115f937a" title="Decodes the data error response." alt="" coords="511,301,663,330"></map>
</div>

</div>
</div><p>
<a class="anchor" name="d536c2272a315395f9e4cf1f7e153620"></a><!-- doxytag: member="sd.c::SD_ReadBlock" ref="d536c2272a315395f9e4cf1f7e153620" args="(uint8_t *buf, uint32_t addr, uint16_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_ReadBlock           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read a block of data from the SD card. 
<p>
Will read a block of data into the specified buffer.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>a character pointer to the destination </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>a 32bit start address </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>the size of the desired block (16bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise </dd></dl>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="a00011_d536c2272a315395f9e4cf1f7e153620_cgraph.png" border="0" usemap="#a00011_d536c2272a315395f9e4cf1f7e153620_cgraph_map" alt=""></center>
<map name="a00011_d536c2272a315395f9e4cf1f7e153620_cgraph_map">
<area shape="rect" id="node3" href="a00011.html#d702de6e3d8967fc351bf7bab00b1d41" title="Decodes the R1 response type." alt="" coords="189,42,307,72"><area shape="rect" id="node5" href="a00011.html#dc0158e94a600dc3b63be4d83c561fb3" title="Reads a response from the SD card." alt="" coords="179,149,317,178"><area shape="rect" id="node13" href="a00011.html#c9fb3c9ff54cfbffe7c4babe9d3bc6ee" title="Reads a data response of a given length." alt="" coords="191,96,305,125"><area shape="rect" id="node20" href="a00011.html#e6f6814ebced9e1eccdce5dbece62cd0" title="Sends a command to the card." alt="" coords="175,228,321,257"><area shape="rect" id="node7" href="a00013.html#05039575653a077fb25a28c31d583243" title="Deassert CS." alt="" coords="405,96,491,125"><area shape="rect" id="node9" href="a00013.html#8ddc120b2a7fc96d17e0bd9f157a94eb" title="Assert CS." alt="" coords="407,149,489,178"><area shape="rect" id="node11" href="a00013.html#a14a3a4150662024315e78864403ff5f" title="Tx/Rx a byte." alt="" coords="573,228,677,257"><area shape="rect" id="node15" href="a00011.html#e03df3cb7531a9d176313802115f937a" title="Decodes the data error response." alt="" coords="372,42,524,72"><area shape="rect" id="node22" href="a00011.html#2b9a7db31f5fb14b84ce4297aba9d99b" title="A simple CRC7 calculation." alt="" coords="405,306,491,336"><area shape="rect" id="node24" href="a00013.html#a71812ceda81f6abdee26dda53868fdd" title="Send a block of data over the SPI." alt="" coords="389,253,507,282"></map>
</div>

</div>
</div><p>
<a class="anchor" name="c9fb3c9ff54cfbffe7c4babe9d3bc6ee"></a><!-- doxytag: member="sd.c::SD_ReadData" ref="c9fb3c9ff54cfbffe7c4babe9d3bc6ee" args="(uint8_t *buf, uint16_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_ReadData           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reads a data response of a given length. 
<p>
The entire response is loaded in the provided buffer. Assumes it's the start of the response and looks for a valid START_BLOCK (0xFE). Will wait for 100 bytes for a valid start or error token.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>a pointer to the destination buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the number of bytes to read (16bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise. </dd></dl>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="a00011_c9fb3c9ff54cfbffe7c4babe9d3bc6ee_cgraph.png" border="0" usemap="#a00011_c9fb3c9ff54cfbffe7c4babe9d3bc6ee_cgraph_map" alt=""></center>
<map name="a00011_c9fb3c9ff54cfbffe7c4babe9d3bc6ee_cgraph_map">
<area shape="rect" id="node3" href="a00011.html#e03df3cb7531a9d176313802115f937a" title="Decodes the data error response." alt="" coords="172,5,324,35"><area shape="rect" id="node5" href="a00013.html#05039575653a077fb25a28c31d583243" title="Deassert CS." alt="" coords="205,59,291,88"><area shape="rect" id="node7" href="a00013.html#8ddc120b2a7fc96d17e0bd9f157a94eb" title="Assert CS." alt="" coords="207,112,289,141"><area shape="rect" id="node9" href="a00013.html#a14a3a4150662024315e78864403ff5f" title="Tx/Rx a byte." alt="" coords="196,165,300,195"></map>
</div>

</div>
</div><p>
<a class="anchor" name="e6f6814ebced9e1eccdce5dbece62cd0"></a><!-- doxytag: member="sd.c::SD_SendCommand" ref="e6f6814ebced9e1eccdce5dbece62cd0" args="(uint8_t command, uint32_t arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_SendCommand           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sends a command to the card. 
<p>
Sends a command and argument with the proper CRC over the SPI line to the SD card. Use <a class="el" href="a00011.html#dc0158e94a600dc3b63be4d83c561fb3" title="Reads a response from the SD card.">SD_GetResponse()</a> to read the card's response.<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="a00011.html#dc0158e94a600dc3b63be4d83c561fb3" title="Reads a response from the SD card.">SD_GetResponse</a></dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>command</em>&nbsp;</td><td>the command to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>arg</em>&nbsp;</td><td>the 32-bit argument to send with the command </td></tr>
  </table>
</dl>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="a00011_e6f6814ebced9e1eccdce5dbece62cd0_cgraph.png" border="0" usemap="#a00011_e6f6814ebced9e1eccdce5dbece62cd0_cgraph_map" alt=""></center>
<map name="a00011_e6f6814ebced9e1eccdce5dbece62cd0_cgraph_map">
<area shape="rect" id="node3" href="a00011.html#2b9a7db31f5fb14b84ce4297aba9d99b" title="A simple CRC7 calculation." alt="" coords="220,5,305,35"><area shape="rect" id="node5" href="a00013.html#a71812ceda81f6abdee26dda53868fdd" title="Send a block of data over the SPI." alt="" coords="204,59,321,88"><area shape="rect" id="node7" href="a00013.html#a14a3a4150662024315e78864403ff5f" title="Tx/Rx a byte." alt="" coords="371,85,475,115"><area shape="rect" id="node9" href="a00013.html#05039575653a077fb25a28c31d583243" title="Deassert CS." alt="" coords="220,163,305,192"><area shape="rect" id="node11" href="a00013.html#8ddc120b2a7fc96d17e0bd9f157a94eb" title="Assert CS." alt="" coords="221,216,304,245"></map>
</div>

</div>
</div><p>
<a class="anchor" name="4e692b3a2d4421d0d7ff2782eac528c5"></a><!-- doxytag: member="sd.c::SD_WriteBlock" ref="4e692b3a2d4421d0d7ff2782eac528c5" args="(uint8_t *data, uint32_t addr, uint16_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_WriteBlock           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Writes a block of data to the SD card. 
<p>
Writes to the SD card in 512byte block sizes. If the data is not large enough, fills the rest of the block with FILL_BYTE.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>pointer to the source of data to write </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>the start address (32bit, must be block aligned) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>the size of the source data (16bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise </dd></dl>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="a00011_4e692b3a2d4421d0d7ff2782eac528c5_cgraph.png" border="0" usemap="#a00011_4e692b3a2d4421d0d7ff2782eac528c5_cgraph_map" alt=""></center>
<map name="a00011_4e692b3a2d4421d0d7ff2782eac528c5_cgraph_map">
<area shape="rect" id="node3" href="a00011.html#519ad77971f09364599528c59e108b59" title="A simple CRC16 calculation (Xmodem)." alt="" coords="207,5,300,35"><area shape="rect" id="node5" href="a00011.html#ae571a1a29dbeeb9a79cae35d7a62de5" title="Continues a CRC16 (Xmodem) check." alt="" coords="195,59,312,88"><area shape="rect" id="node7" href="a00011.html#6ce33f8b0dfdecdd04ed9e1395c36d46" title="Decodes the R2 response type." alt="" coords="173,112,333,141"><area shape="rect" id="node9" href="a00011.html#d702de6e3d8967fc351bf7bab00b1d41" title="Decodes the R1 response type." alt="" coords="195,165,312,195"><area shape="rect" id="node11" href="a00011.html#dc0158e94a600dc3b63be4d83c561fb3" title="Reads a response from the SD card." alt="" coords="184,269,323,299"><area shape="rect" id="node13" href="a00013.html#05039575653a077fb25a28c31d583243" title="Deassert CS." alt="" coords="399,241,484,271"><area shape="rect" id="node15" href="a00013.html#8ddc120b2a7fc96d17e0bd9f157a94eb" title="Assert CS." alt="" coords="400,295,483,324"><area shape="rect" id="node17" href="a00013.html#a14a3a4150662024315e78864403ff5f" title="Tx/Rx a byte." alt="" coords="549,427,653,456"><area shape="rect" id="node19" href="a00011.html#e6f6814ebced9e1eccdce5dbece62cd0" title="Sends a command to the card." alt="" coords="180,373,327,403"><area shape="rect" id="node23" href="a00013.html#a71812ceda81f6abdee26dda53868fdd" title="Send a block of data over the SPI." alt="" coords="383,452,500,481"><area shape="rect" id="node21" href="a00011.html#2b9a7db31f5fb14b84ce4297aba9d99b" title="A simple CRC7 calculation." alt="" coords="399,348,484,377"></map>
</div>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Mar 8 19:36:24 2009 for AVR SD Interface by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
