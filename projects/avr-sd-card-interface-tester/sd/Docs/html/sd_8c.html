<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AVR SD Interface: sd.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>sd.c File Reference</h1>SD SPI interface.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;inttypes.h&gt;</code><br>
<code>#include &lt;avr/sfr_defs.h&gt;</code><br>
<code>#include &lt;avr/io.h&gt;</code><br>
<code>#include &lt;avr/interrupt.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &quot;<a class="el" href="sd_8h-source.html">sd.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="spi_8h-source.html">spi.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="utils_8h-source.html">utils.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for sd.c:</div>
<div class="dynsection">
<p><center><img src="sd_8c__incl.png" border="0" usemap="#sd.c_map" alt=""></center>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#322e7d77822e29ed8b6ec313cc027cd9">SD_USE_CRC</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#e3dd15ec52cbd1ef2ce6e20e39fd6efb">CMD_GO_IDLE_STATE</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#e059745768a7fde0832a1dea6a623ab0">CMD_SEND_OP_COND</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#773735b7bef10597c3db4f8a60e42ad3">CMD_SEND_IF_COND</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#039c816f90fba6c89d09980c5c1cb888">CMD_SEND_CSD</a>&nbsp;&nbsp;&nbsp;9</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#69e5cfa724af0af3e97d69005a2b588d">CMD_SEND_CID</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#d78a2aaecc9a9897f7da971d81e3785a">CMD_STOP_TRANSMISSION</a>&nbsp;&nbsp;&nbsp;12</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#fc227f5ab9e89ace42c1416fa095f8aa">CMD_SEND_STATUS</a>&nbsp;&nbsp;&nbsp;13</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#cc98caadb00bb27cee9c6037193adb68">CMD_SET_BLOCKLEN</a>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#bfe445b381f51fa7f4aaaa74c6184c31">CMD_READ_BLOCK</a>&nbsp;&nbsp;&nbsp;17</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#a80d29db85713b1fffcf39b37d67e69b">CMD_WRITE_BLOCK</a>&nbsp;&nbsp;&nbsp;24</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#2e1d803a81add9a4f5254f06b5795834">CMD_ERASE_BLOCK_START</a>&nbsp;&nbsp;&nbsp;32</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#1292e676d8d4831731fa808f43f3175e">CMD_ERASE_BLOCK_END</a>&nbsp;&nbsp;&nbsp;33</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#73d541696536a935eec42edc03359e96">CMD_ERASE</a>&nbsp;&nbsp;&nbsp;38</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#5625571f0a42246f009e1695f5c0fd88">CMD_READ_OCR</a>&nbsp;&nbsp;&nbsp;58</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#fb5d8ee662bb31ad2821f5321ea4e72a">CMD_CRC_ONOFF</a>&nbsp;&nbsp;&nbsp;59</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#cdb057504ceebb40cb4a5df3197a8fb5">APP_CMD</a>&nbsp;&nbsp;&nbsp;55</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#38e73c548131f1fd3f8acdad82fd44fb">SD_SEND_OP_COND</a>&nbsp;&nbsp;&nbsp;41</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#dee7c13eaeccaf3a5e695387c1715ce7">R1_IDLE</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#4598fdd1bd123e39ca45cdcd30f2a0bb">R1_ERASE_RESET</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#20c1db50084f3de0e58aee0be61c82a8">R1_ILLEGAL_CMD</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#b65aca3ffa8444c4f7d3892c3d1a9d5f">R1_CRC_ERROR</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#20d5ba3f7c05955be378cbcef5d1b452">R1_ERASE_ERROR</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#b7a9e062c9bcb3ef8d9d909a4abbe4b7">R1_ADDR_ERROR</a>&nbsp;&nbsp;&nbsp;0x20</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#31f08587a1525ee3725c60d69e40bbb8">R1_PARAM_ERROR</a>&nbsp;&nbsp;&nbsp;0x40</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#5f137187c6a892935c5acd036f609b22">NO_RESPONSE</a>&nbsp;&nbsp;&nbsp;0xFF</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#d51ded0bbd705f02f73fc60c0b721ced">BLOCK_SIZE</a>&nbsp;&nbsp;&nbsp;512</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#ed747105ccaf2d97d28348011a53bde9">FILL_BYTE</a>&nbsp;&nbsp;&nbsp;0xFF</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#3f2e01a09cd6ec5fa9babf6cd3ba8f79">START_BLOCK</a>&nbsp;&nbsp;&nbsp;0xFE</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#5e4732ff0ea175b06d3d2f2ae9905e02">CMD_BYTE_LENGTH</a>&nbsp;&nbsp;&nbsp;6</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#917c2f59272ac3db92f06f84f87fbf35">CRC16_POLYN</a>&nbsp;&nbsp;&nbsp;0x1021</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#7a31f8cd5e4ddd7afed33f08de2c4f15">SD_DelayBytes</a> (uint16_t bytes)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Clocks out on the SPI line.  <a href="#7a31f8cd5e4ddd7afed33f08de2c4f15"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#e6f6814ebced9e1eccdce5dbece62cd0">SD_SendCommand</a> (uint8_t command, uint32_t arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sends a command to the card.  <a href="#e6f6814ebced9e1eccdce5dbece62cd0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#6adf6824b8f4566ddd4d3965c6e86d6e">SD_CheckForCard</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks for the presence of a card.  <a href="#6adf6824b8f4566ddd4d3965c6e86d6e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#dc0158e94a600dc3b63be4d83c561fb3">SD_GetResponse</a> (uint8_t *buf, uint16_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reads a response from the SD card.  <a href="#dc0158e94a600dc3b63be4d83c561fb3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#c9fb3c9ff54cfbffe7c4babe9d3bc6ee">SD_ReadData</a> (uint8_t *buf, uint16_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reads a data response of a given length.  <a href="#c9fb3c9ff54cfbffe7c4babe9d3bc6ee"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#d702de6e3d8967fc351bf7bab00b1d41">SD_DecodeR1</a> (uint8_t res)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Decodes the R1 response type.  <a href="#d702de6e3d8967fc351bf7bab00b1d41"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#6ce33f8b0dfdecdd04ed9e1395c36d46">SD_DecodeDataRes</a> (uint8_t res)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Decodes the R2 response type.  <a href="#6ce33f8b0dfdecdd04ed9e1395c36d46"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#e03df3cb7531a9d176313802115f937a">SD_DecodeDataErr</a> (uint8_t res)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Decodes the data error response.  <a href="#e03df3cb7531a9d176313802115f937a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#2b9a7db31f5fb14b84ce4297aba9d99b">SD_CRC7</a> (uint8_t *bytes, uint32_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A simple CRC7 calculation.  <a href="#2b9a7db31f5fb14b84ce4297aba9d99b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#519ad77971f09364599528c59e108b59">SD_CRC16</a> (uint8_t *bytes, uint32_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A simple CRC16 calculation (Xmodem).  <a href="#519ad77971f09364599528c59e108b59"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#ae571a1a29dbeeb9a79cae35d7a62de5">SD_CRC16_Fill</a> (uint16_t crc, uint8_t const_value, uint32_t length)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Continues a CRC16 (Xmodem) check.  <a href="#ae571a1a29dbeeb9a79cae35d7a62de5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#a7a6e00a7867366345f8ba72c5fa58c5">SD_Init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the SD card.  <a href="#a7a6e00a7867366345f8ba72c5fa58c5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#d536c2272a315395f9e4cf1f7e153620">SD_ReadBlock</a> (uint8_t *buf, uint32_t addr, uint16_t size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read a block of data from the SD card.  <a href="#d536c2272a315395f9e4cf1f7e153620"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#4e692b3a2d4421d0d7ff2782eac528c5">SD_WriteBlock</a> (uint8_t *data, uint32_t addr, uint16_t size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Writes a block of data to the SD card.  <a href="#4e692b3a2d4421d0d7ff2782eac528c5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#3c2a169297f1c0eb348a950ce0288687">SD_EraseBlock</a> (uint32_t addr, uint32_t size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Erases a block of data from the SD card.  <a href="#3c2a169297f1c0eb348a950ce0288687"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd_8c.html#1a4c6adc98fd729b603cf07e2441dec1">scratch</a> [32]</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
SD SPI interface. 
<p>
A simple SD interface using SPI. This relies on the associated SPI interface, but should be relatively simple to recreate.<p>
This interface is somewhat bloated. It is not intended to be fast, but instead helpful for debugging and learning. <hr><h2>Define Documentation</h2>
<a class="anchor" name="cdb057504ceebb40cb4a5df3197a8fb5"></a><!-- doxytag: member="sd.c::APP_CMD" ref="cdb057504ceebb40cb4a5df3197a8fb5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define APP_CMD&nbsp;&nbsp;&nbsp;55          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="d51ded0bbd705f02f73fc60c0b721ced"></a><!-- doxytag: member="sd.c::BLOCK_SIZE" ref="d51ded0bbd705f02f73fc60c0b721ced" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BLOCK_SIZE&nbsp;&nbsp;&nbsp;512          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="5e4732ff0ea175b06d3d2f2ae9905e02"></a><!-- doxytag: member="sd.c::CMD_BYTE_LENGTH" ref="5e4732ff0ea175b06d3d2f2ae9905e02" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_BYTE_LENGTH&nbsp;&nbsp;&nbsp;6          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="fb5d8ee662bb31ad2821f5321ea4e72a"></a><!-- doxytag: member="sd.c::CMD_CRC_ONOFF" ref="fb5d8ee662bb31ad2821f5321ea4e72a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_CRC_ONOFF&nbsp;&nbsp;&nbsp;59          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="73d541696536a935eec42edc03359e96"></a><!-- doxytag: member="sd.c::CMD_ERASE" ref="73d541696536a935eec42edc03359e96" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_ERASE&nbsp;&nbsp;&nbsp;38          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="1292e676d8d4831731fa808f43f3175e"></a><!-- doxytag: member="sd.c::CMD_ERASE_BLOCK_END" ref="1292e676d8d4831731fa808f43f3175e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_ERASE_BLOCK_END&nbsp;&nbsp;&nbsp;33          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="2e1d803a81add9a4f5254f06b5795834"></a><!-- doxytag: member="sd.c::CMD_ERASE_BLOCK_START" ref="2e1d803a81add9a4f5254f06b5795834" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_ERASE_BLOCK_START&nbsp;&nbsp;&nbsp;32          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="e3dd15ec52cbd1ef2ce6e20e39fd6efb"></a><!-- doxytag: member="sd.c::CMD_GO_IDLE_STATE" ref="e3dd15ec52cbd1ef2ce6e20e39fd6efb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_GO_IDLE_STATE&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="bfe445b381f51fa7f4aaaa74c6184c31"></a><!-- doxytag: member="sd.c::CMD_READ_BLOCK" ref="bfe445b381f51fa7f4aaaa74c6184c31" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_READ_BLOCK&nbsp;&nbsp;&nbsp;17          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="5625571f0a42246f009e1695f5c0fd88"></a><!-- doxytag: member="sd.c::CMD_READ_OCR" ref="5625571f0a42246f009e1695f5c0fd88" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_READ_OCR&nbsp;&nbsp;&nbsp;58          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="69e5cfa724af0af3e97d69005a2b588d"></a><!-- doxytag: member="sd.c::CMD_SEND_CID" ref="69e5cfa724af0af3e97d69005a2b588d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_SEND_CID&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="039c816f90fba6c89d09980c5c1cb888"></a><!-- doxytag: member="sd.c::CMD_SEND_CSD" ref="039c816f90fba6c89d09980c5c1cb888" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_SEND_CSD&nbsp;&nbsp;&nbsp;9          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="773735b7bef10597c3db4f8a60e42ad3"></a><!-- doxytag: member="sd.c::CMD_SEND_IF_COND" ref="773735b7bef10597c3db4f8a60e42ad3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_SEND_IF_COND&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="e059745768a7fde0832a1dea6a623ab0"></a><!-- doxytag: member="sd.c::CMD_SEND_OP_COND" ref="e059745768a7fde0832a1dea6a623ab0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_SEND_OP_COND&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="fc227f5ab9e89ace42c1416fa095f8aa"></a><!-- doxytag: member="sd.c::CMD_SEND_STATUS" ref="fc227f5ab9e89ace42c1416fa095f8aa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_SEND_STATUS&nbsp;&nbsp;&nbsp;13          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="cc98caadb00bb27cee9c6037193adb68"></a><!-- doxytag: member="sd.c::CMD_SET_BLOCKLEN" ref="cc98caadb00bb27cee9c6037193adb68" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_SET_BLOCKLEN&nbsp;&nbsp;&nbsp;16          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="d78a2aaecc9a9897f7da971d81e3785a"></a><!-- doxytag: member="sd.c::CMD_STOP_TRANSMISSION" ref="d78a2aaecc9a9897f7da971d81e3785a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_STOP_TRANSMISSION&nbsp;&nbsp;&nbsp;12          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="a80d29db85713b1fffcf39b37d67e69b"></a><!-- doxytag: member="sd.c::CMD_WRITE_BLOCK" ref="a80d29db85713b1fffcf39b37d67e69b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CMD_WRITE_BLOCK&nbsp;&nbsp;&nbsp;24          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="917c2f59272ac3db92f06f84f87fbf35"></a><!-- doxytag: member="sd.c::CRC16_POLYN" ref="917c2f59272ac3db92f06f84f87fbf35" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CRC16_POLYN&nbsp;&nbsp;&nbsp;0x1021          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="ed747105ccaf2d97d28348011a53bde9"></a><!-- doxytag: member="sd.c::FILL_BYTE" ref="ed747105ccaf2d97d28348011a53bde9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FILL_BYTE&nbsp;&nbsp;&nbsp;0xFF          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="5f137187c6a892935c5acd036f609b22"></a><!-- doxytag: member="sd.c::NO_RESPONSE" ref="5f137187c6a892935c5acd036f609b22" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NO_RESPONSE&nbsp;&nbsp;&nbsp;0xFF          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="b7a9e062c9bcb3ef8d9d909a4abbe4b7"></a><!-- doxytag: member="sd.c::R1_ADDR_ERROR" ref="b7a9e062c9bcb3ef8d9d909a4abbe4b7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R1_ADDR_ERROR&nbsp;&nbsp;&nbsp;0x20          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="b65aca3ffa8444c4f7d3892c3d1a9d5f"></a><!-- doxytag: member="sd.c::R1_CRC_ERROR" ref="b65aca3ffa8444c4f7d3892c3d1a9d5f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R1_CRC_ERROR&nbsp;&nbsp;&nbsp;0x08          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="20d5ba3f7c05955be378cbcef5d1b452"></a><!-- doxytag: member="sd.c::R1_ERASE_ERROR" ref="20d5ba3f7c05955be378cbcef5d1b452" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R1_ERASE_ERROR&nbsp;&nbsp;&nbsp;0x10          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="4598fdd1bd123e39ca45cdcd30f2a0bb"></a><!-- doxytag: member="sd.c::R1_ERASE_RESET" ref="4598fdd1bd123e39ca45cdcd30f2a0bb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R1_ERASE_RESET&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="dee7c13eaeccaf3a5e695387c1715ce7"></a><!-- doxytag: member="sd.c::R1_IDLE" ref="dee7c13eaeccaf3a5e695387c1715ce7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R1_IDLE&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="20c1db50084f3de0e58aee0be61c82a8"></a><!-- doxytag: member="sd.c::R1_ILLEGAL_CMD" ref="20c1db50084f3de0e58aee0be61c82a8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R1_ILLEGAL_CMD&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="31f08587a1525ee3725c60d69e40bbb8"></a><!-- doxytag: member="sd.c::R1_PARAM_ERROR" ref="31f08587a1525ee3725c60d69e40bbb8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define R1_PARAM_ERROR&nbsp;&nbsp;&nbsp;0x40          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="38e73c548131f1fd3f8acdad82fd44fb"></a><!-- doxytag: member="sd.c::SD_SEND_OP_COND" ref="38e73c548131f1fd3f8acdad82fd44fb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_SEND_OP_COND&nbsp;&nbsp;&nbsp;41          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="322e7d77822e29ed8b6ec313cc027cd9"></a><!-- doxytag: member="sd.c::SD_USE_CRC" ref="322e7d77822e29ed8b6ec313cc027cd9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_USE_CRC          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="3f2e01a09cd6ec5fa9babf6cd3ba8f79"></a><!-- doxytag: member="sd.c::START_BLOCK" ref="3f2e01a09cd6ec5fa9babf6cd3ba8f79" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define START_BLOCK&nbsp;&nbsp;&nbsp;0xFE          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="6adf6824b8f4566ddd4d3965c6e86d6e"></a><!-- doxytag: member="sd.c::SD_CheckForCard" ref="6adf6824b8f4566ddd4d3965c6e86d6e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_CheckForCard           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Checks for the presence of a card. 
<p>
Issues CMD_GO_IDLE_STATE 10 times or until a response is received.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if card is found, 0 otherwise </dd></dl>

</div>
</div><p>
<a class="anchor" name="519ad77971f09364599528c59e108b59"></a><!-- doxytag: member="sd.c::SD_CRC16" ref="519ad77971f09364599528c59e108b59" args="(uint8_t *bytes, uint32_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t SD_CRC16           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
A simple CRC16 calculation (Xmodem). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bytes</em>&nbsp;</td><td>a pointer to the source data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the length of the source data (32bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the resultant CRC (16bit) </dd></dl>

</div>
</div><p>
<a class="anchor" name="ae571a1a29dbeeb9a79cae35d7a62de5"></a><!-- doxytag: member="sd.c::SD_CRC16_Fill" ref="ae571a1a29dbeeb9a79cae35d7a62de5" args="(uint16_t crc, uint8_t const_value, uint32_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t SD_CRC16_Fill           </td>
          <td>(</td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>crc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>const_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Continues a CRC16 (Xmodem) check. 
<p>
Allows you to calculate the crc for a constant stream of bytes.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>crc</em>&nbsp;</td><td>the starting CRC </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>const_value</em>&nbsp;</td><td>the constant byte to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the number of bytes to run through the CRC</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the resultant CRC (16bit) </dd></dl>

</div>
</div><p>
<a class="anchor" name="2b9a7db31f5fb14b84ce4297aba9d99b"></a><!-- doxytag: member="sd.c::SD_CRC7" ref="2b9a7db31f5fb14b84ce4297aba9d99b" args="(uint8_t *bytes, uint32_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_CRC7           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
A simple CRC7 calculation. 
<p>
CRC7 function, stolen from some SHARP docs, which stole it from some Siemens docs...<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bytes</em>&nbsp;</td><td>a pointer to the source data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the length of the source data (32bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the resultant CRC (8bit) </dd></dl>

</div>
</div><p>
<a class="anchor" name="e03df3cb7531a9d176313802115f937a"></a><!-- doxytag: member="sd.c::SD_DecodeDataErr" ref="e03df3cb7531a9d176313802115f937a" args="(uint8_t res)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_DecodeDataErr           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>res</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Decodes the data error response. 
<p>
Decodes the data error response and prints out an error message, if applicable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>the data error response </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="6ce33f8b0dfdecdd04ed9e1395c36d46"></a><!-- doxytag: member="sd.c::SD_DecodeDataRes" ref="6ce33f8b0dfdecdd04ed9e1395c36d46" args="(uint8_t res)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_DecodeDataRes           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>res</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Decodes the R2 response type. 
<p>
Decodes the R2 response and prints out an error message, if applicable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>the R2 response Decodes the data response Decodes the data response and prints out an error message, if applicable.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>the data response </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="d702de6e3d8967fc351bf7bab00b1d41"></a><!-- doxytag: member="sd.c::SD_DecodeR1" ref="d702de6e3d8967fc351bf7bab00b1d41" args="(uint8_t res)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_DecodeR1           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>res</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Decodes the R1 response type. 
<p>
Decodes the R1 response and prints out an error message, if applicable.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>res</em>&nbsp;</td><td>the R1 response </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="7a31f8cd5e4ddd7afed33f08de2c4f15"></a><!-- doxytag: member="sd.c::SD_DelayBytes" ref="7a31f8cd5e4ddd7afed33f08de2c4f15" args="(uint16_t bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_DelayBytes           </td>
          <td>(</td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>bytes</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Clocks out on the SPI line. 
<p>
Sends 0xFF over the SPI line as a way to feed the SD card a clock with no data.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bytes</em>&nbsp;</td><td>the number of bytes to clock out (16bit) </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="3c2a169297f1c0eb348a950ce0288687"></a><!-- doxytag: member="sd.c::SD_EraseBlock" ref="3c2a169297f1c0eb348a950ce0288687" args="(uint32_t addr, uint32_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_EraseBlock           </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Erases a block of data from the SD card. 
<p>
Erases data starting at addr and ending at addr+size (inclusive). The SD card will erase all 512byte blocks that the range touches.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>the 32bit start address </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>the size of the block to erase (32bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise </dd></dl>

</div>
</div><p>
<a class="anchor" name="dc0158e94a600dc3b63be4d83c561fb3"></a><!-- doxytag: member="sd.c::SD_GetResponse" ref="dc0158e94a600dc3b63be4d83c561fb3" args="(uint8_t *buf, uint16_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_GetResponse           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reads a response from the SD card. 
<p>
Reads a response of a given length into the specified buffer. The entire response is loaded in the provided buffer, and the first byte is duplicated as the return value<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>a pointer to the destination buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the number of bytes to read as the response (16bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the first byte of the response </dd></dl>

</div>
</div><p>
<a class="anchor" name="a7a6e00a7867366345f8ba72c5fa58c5"></a><!-- doxytag: member="sd.c::SD_Init" ref="a7a6e00a7867366345f8ba72c5fa58c5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_Init           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize the SD card. 
<p>
Attempts to initialize an SD card on the SPI bus. Will go through the standard initialization procedures, and then print out the CID and CSD in hex.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise </dd></dl>

</div>
</div><p>
<a class="anchor" name="d536c2272a315395f9e4cf1f7e153620"></a><!-- doxytag: member="sd.c::SD_ReadBlock" ref="d536c2272a315395f9e4cf1f7e153620" args="(uint8_t *buf, uint32_t addr, uint16_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_ReadBlock           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read a block of data from the SD card. 
<p>
Will read a block of data into the specified buffer.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>a character pointer to the destination </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>a 32bit start address </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>the size of the desired block (16bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise </dd></dl>

</div>
</div><p>
<a class="anchor" name="c9fb3c9ff54cfbffe7c4babe9d3bc6ee"></a><!-- doxytag: member="sd.c::SD_ReadData" ref="c9fb3c9ff54cfbffe7c4babe9d3bc6ee" args="(uint8_t *buf, uint16_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_ReadData           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Reads a data response of a given length. 
<p>
The entire response is loaded in the provided buffer. Assumes it's the start of the response and looks for a valid START_BLOCK (0xFE). Will wait for 100 bytes for a valid start or error token.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>a pointer to the destination buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>length</em>&nbsp;</td><td>the number of bytes to read (16bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise. </dd></dl>

</div>
</div><p>
<a class="anchor" name="e6f6814ebced9e1eccdce5dbece62cd0"></a><!-- doxytag: member="sd.c::SD_SendCommand" ref="e6f6814ebced9e1eccdce5dbece62cd0" args="(uint8_t command, uint32_t arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SD_SendCommand           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>arg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Sends a command to the card. 
<p>
Sends a command and argument with the proper CRC over the SPI line to the SD card. Use <a class="el" href="sd_8c.html#dc0158e94a600dc3b63be4d83c561fb3" title="Reads a response from the SD card.">SD_GetResponse()</a> to read the card's response.<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="sd_8c.html#dc0158e94a600dc3b63be4d83c561fb3" title="Reads a response from the SD card.">SD_GetResponse</a></dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>command</em>&nbsp;</td><td>the command to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>arg</em>&nbsp;</td><td>the 32-bit argument to send with the command </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="4e692b3a2d4421d0d7ff2782eac528c5"></a><!-- doxytag: member="sd.c::SD_WriteBlock" ref="4e692b3a2d4421d0d7ff2782eac528c5" args="(uint8_t *data, uint32_t addr, uint16_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t SD_WriteBlock           </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Writes a block of data to the SD card. 
<p>
Writes to the SD card in 512byte block sizes. If the data is not large enough, fills the rest of the block with FILL_BYTE.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>pointer to the source of data to write </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>the start address (32bit, must be block aligned) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>the size of the source data (16bit)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if sucessful, 0 otherwise </dd></dl>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="1a4c6adc98fd729b603cf07e2441dec1"></a><!-- doxytag: member="sd.c::scratch" ref="1a4c6adc98fd729b603cf07e2441dec1" args="[32]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="sd_8c.html#1a4c6adc98fd729b603cf07e2441dec1">scratch</a>[32]<code> [static]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Mar 8 19:07:41 2009 for AVR SD Interface by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
