<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AVR SD Interface: main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>main.c File Reference</h1>SD Card Tester.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;avr/io.h&gt;</code><br>
<code>#include &lt;avr/interrupt.h&gt;</code><br>
<code>#include &lt;util/delay.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;inttypes.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &quot;<a class="el" href="spi_8h-source.html">spi.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="sci_8h-source.html">sci.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="terminal_8h-source.html">terminal.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="sd_8h-source.html">sd.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="utils_8h-source.html">utils.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for main.c:</div>
<div class="dynsection">
<p><center><img src="main_8c__incl.png" border="0" usemap="#main.c_map" alt=""></center>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#d09d45a0a1963b6c0086dd654e898d8a">Interrupts_Disable</a>()&nbsp;&nbsp;&nbsp;cli()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#16fdde8e7d29aa736205805da9f6d845">Interrupts_Enable</a>()&nbsp;&nbsp;&nbsp;sei()</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#56539e5c1d92ebb5cdab1cdd0d27ff18">get</a> (char *args)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read data off the SPI line.  <a href="#56539e5c1d92ebb5cdab1cdd0d27ff18"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#54cadc5cb83c60f7beb62ba39b46a29b">read</a> (char *args)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read a block of data from the SD card.  <a href="#54cadc5cb83c60f7beb62ba39b46a29b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#8b401db25875269a5bdaaef390c62b12">write</a> (char *args)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write some text to the SD card.  <a href="#8b401db25875269a5bdaaef390c62b12"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#70b57a4e6258f16c5216c2b2aeba20e9">erase</a> (char *args)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Erase a block of data on the SD card.  <a href="#70b57a4e6258f16c5216c2b2aeba20e9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#b358f967cbbd57b21910d1124eec7534">scan</a> (char *args)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Scans through the SD card looking for non-blank sections.  <a href="#b358f967cbbd57b21910d1124eec7534"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#0a4ce12276564eb224e3c4b025e3835e">sdinit</a> (char *args)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the SD card.  <a href="#0a4ce12276564eb224e3c4b025e3835e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#f2d813efb59f6d81f5fc3d757dd3c3a7">help</a> (char *args)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prints out a list of supported commands.  <a href="#f2d813efb59f6d81f5fc3d757dd3c3a7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main.  <a href="#840291bc02cba5474a4cb46a9b9566fe"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="command_8h.html#8f79b9a450e3706337eb776f079be727">CommandList</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#dacb04d9a22c0b04d1cbbe8b901b4ef6">cmdList</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#0b8957235132e3b5fd259873eaeec595">cmdLength</a> = sizeof(<a class="el" href="main_8c.html#dacb04d9a22c0b04d1cbbe8b901b4ef6">cmdList</a>)/sizeof(<a class="el" href="struct_command_def.html">CommandDef</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *const&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#225ab49c6362bf9b5f142fdcbe53b9a7">welcomeMessage</a> = &quot;\nSD Card Tester v0.2.0&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *const&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#eb94adf3c5d8b90e1cd759bf298a021c">promptString</a> = &quot;&gt; &quot;</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
SD Card Tester. 
<p>
This application provides a command-line-like interface to run simple commands against an SD card attached to the SPI line.<p>
Currently, this software has only been tested on the ATmega16.<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Stefan Filipek </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>March 2009 </dd></dl>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="d09d45a0a1963b6c0086dd654e898d8a"></a><!-- doxytag: member="main.c::Interrupts_Disable" ref="d09d45a0a1963b6c0086dd654e898d8a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Interrupts_Disable          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;cli()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="16fdde8e7d29aa736205805da9f6d845"></a><!-- doxytag: member="main.c::Interrupts_Enable" ref="16fdde8e7d29aa736205805da9f6d845" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Interrupts_Enable          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;sei()</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="70b57a4e6258f16c5216c2b2aeba20e9"></a><!-- doxytag: member="main.c::erase" ref="70b57a4e6258f16c5216c2b2aeba20e9" args="(char *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t erase           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Erase a block of data on the SD card. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>a space seperated string containing the start address followed by the length (both 32bit).</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if successful, 0 otherwise </dd></dl>

</div>
</div><p>
<a class="anchor" name="56539e5c1d92ebb5cdab1cdd0d27ff18"></a><!-- doxytag: member="main.c::get" ref="56539e5c1d92ebb5cdab1cdd0d27ff18" args="(char *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t get           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read data off the SPI line. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>a space separated string containing the number of bytes to read off, limited to 256. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="f2d813efb59f6d81f5fc3d757dd3c3a7"></a><!-- doxytag: member="main.c::help" ref="f2d813efb59f6d81f5fc3d757dd3c3a7" args="(char *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t help           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Prints out a list of supported commands. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>(not used)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1, always </dd></dl>

</div>
</div><p>
<a class="anchor" name="840291bc02cba5474a4cb46a9b9566fe"></a><!-- doxytag: member="main.c::main" ref="840291bc02cba5474a4cb46a9b9566fe" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Main. 
<p>

</div>
</div><p>
<a class="anchor" name="54cadc5cb83c60f7beb62ba39b46a29b"></a><!-- doxytag: member="main.c::read" ref="54cadc5cb83c60f7beb62ba39b46a29b" args="(char *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t read           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read a block of data from the SD card. 
<p>
Reads a block of data and prints it using the print_block function in <a class="el" href="utils_8c.html" title="Random, useful utilities.">utils.c</a><p>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="utils_8h.html#99a379f9cee5d825ab7f639887f1c2ee" title="Prints a block of hex in a pretty way.">print_block</a></dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>a space seperated string containing an address (32bit) followed by a length (16bit).</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1, always </dd></dl>

</div>
</div><p>
<a class="anchor" name="b358f967cbbd57b21910d1124eec7534"></a><!-- doxytag: member="main.c::scan" ref="b358f967cbbd57b21910d1124eec7534" args="(char *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t scan           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Scans through the SD card looking for non-blank sections. 
<p>
Scans across the SD card in 32-byte blocks and prints out ones containing at least one non FF value. Formatted using <a class="el" href="utils_8c.html#2bd9099a2df3109fa801b238d5d30895" title="Prints a block of hex in a pretty way.">print_block()</a> in <a class="el" href="utils_8c.html" title="Random, useful utilities.">utils.c</a>.<p>
Contiguous blocks are printed as such. Any breaks are signaled with an extra newline between blocks.<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="utils_8h.html#99a379f9cee5d825ab7f639887f1c2ee" title="Prints a block of hex in a pretty way.">print_block</a></dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>a space seperated string containing an address followed by a length.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1, always </dd></dl>

</div>
</div><p>
<a class="anchor" name="0a4ce12276564eb224e3c4b025e3835e"></a><!-- doxytag: member="main.c::sdinit" ref="0a4ce12276564eb224e3c4b025e3835e" args="(char *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t sdinit           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialize the SD card. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>is not used </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1, always </dd></dl>

</div>
</div><p>
<a class="anchor" name="8b401db25875269a5bdaaef390c62b12"></a><!-- doxytag: member="main.c::write" ref="8b401db25875269a5bdaaef390c62b12" args="(char *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t write           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>args</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write some text to the SD card. 
<p>
Writes a block of text to the address specified. Right now the address must be block aligned, or an error will occur.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>a space seperated string containing an address (32bit) followed by the string to write.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>1 if successful, 0 otherwise </dd></dl>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="0b8957235132e3b5fd259873eaeec595"></a><!-- doxytag: member="main.c::cmdLength" ref="0b8957235132e3b5fd259873eaeec595" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const uint16_t <a class="el" href="main_8c.html#0b8957235132e3b5fd259873eaeec595">cmdLength</a> = sizeof(<a class="el" href="main_8c.html#dacb04d9a22c0b04d1cbbe8b901b4ef6">cmdList</a>)/sizeof(<a class="el" href="struct_command_def.html">CommandDef</a>)<code> [static]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="dacb04d9a22c0b04d1cbbe8b901b4ef6"></a><!-- doxytag: member="main.c::cmdList" ref="dacb04d9a22c0b04d1cbbe8b901b4ef6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="command_8h.html#8f79b9a450e3706337eb776f079be727">CommandList</a> <a class="el" href="main_8c.html#dacb04d9a22c0b04d1cbbe8b901b4ef6">cmdList</a><code> [static]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
  {<span class="stringliteral">"get"</span>, <span class="keyword">get</span>},
  {<span class="stringliteral">"read"</span>, <a class="code" href="main_8c.html#54cadc5cb83c60f7beb62ba39b46a29b" title="Read a block of data from the SD card.">read</a>},
  {<span class="stringliteral">"write"</span>, <a class="code" href="main_8c.html#8b401db25875269a5bdaaef390c62b12" title="Write some text to the SD card.">write</a>},
  {<span class="stringliteral">"erase"</span>, <a class="code" href="main_8c.html#70b57a4e6258f16c5216c2b2aeba20e9" title="Erase a block of data on the SD card.">erase</a>},
  {<span class="stringliteral">"scan"</span>, <a class="code" href="main_8c.html#b358f967cbbd57b21910d1124eec7534" title="Scans through the SD card looking for non-blank sections.">scan</a>},
  {<span class="stringliteral">"sdinit"</span>, <a class="code" href="main_8c.html#0a4ce12276564eb224e3c4b025e3835e" title="Initialize the SD card.">sdinit</a>},
  {<span class="stringliteral">"help"</span>, <a class="code" href="main_8c.html#f2d813efb59f6d81f5fc3d757dd3c3a7" title="Prints out a list of supported commands.">help</a>}
}
</pre></div>
</div>
</div><p>
<a class="anchor" name="eb94adf3c5d8b90e1cd759bf298a021c"></a><!-- doxytag: member="main.c::promptString" ref="eb94adf3c5d8b90e1cd759bf298a021c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* const <a class="el" href="terminal_8c.html#2f7989b541690304ec29e1a6e3a6298f">promptString</a> = &quot;&gt; &quot;<code> [static]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="225ab49c6362bf9b5f142fdcbe53b9a7"></a><!-- doxytag: member="main.c::welcomeMessage" ref="225ab49c6362bf9b5f142fdcbe53b9a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* const <a class="el" href="terminal_8c.html#4b946008e079a0daeab0360266984e21">welcomeMessage</a> = &quot;\nSD Card Tester v0.2.0&quot;<code> [static]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Mar 8 19:07:41 2009 for AVR SD Interface by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
