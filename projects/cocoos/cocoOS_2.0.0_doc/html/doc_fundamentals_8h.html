<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>cocoOS: docFundamentals.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>docFundamentals.h File Reference</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
<b> Introduction </b> <br>
 cocoOS is a free, open source, cooperative task scheduler, based on coroutines. <br>
<p>
Task procedures scheduled by cooperative kernels are so called RTC's, run to completion tasks. They execute from the first line of the procedure to the last line. The use of coroutines enables us to implement task procedures that does not have to execute all the way down to the last line of code. Instead execution can end in the middle e.g waiting for a semaphore to be released. When execution is resumed, it continues at that line. <br>
 <br>
<p>
With coroutines, this can be done without having to save the complete task context when switching to another task. Also, task procedures can be outlined in the same style as when using a traditional preemptive RTOS.<p>
cocoOS is extremely portable to any target which makes it a perfect choice during early phases of the development when which OS to use is still an open issue.<p>
<b>Getting Started </b><br>
<p>
<b>Configuration </b><br>
 To setup cocoOS you have to define 4 constants in <a class="el" href="os__defines_8h.html">os_defines.h</a>. These are: <br>
<ul>
<li>N_TASKS: maximum number of tasks</li><li>N_QUEUES: maxmimum number of message queues</li><li>N_SEMAPHORES: maximum number of semaphores</li><li>N_EVENTS: maximum numer of events</li></ul>
<p>
Allowed range for these constants is 0-254. These constants sets the maximum value for the number of used ojects of the specified types. It is allowed to use fewer but not more number of objects. To save RAM it is recommended to keep these values as low as possible. <br>
<p>
<b>System setup - application main function </b> <br>
 As usual you have to setup your system, ports, clocks etc in the beginning of your main function. It is also in the main function you create all tasks, semaphores and events. As final steps in the setup you call <a class="el" href="os__appl_a_p_i_8h.html#6cc2e63d83267ff5059bf0a76b302a09">os_init()</a> to setup the kernel and finally you start the clock and places a call to <a class="el" href="os__appl_a_p_i_8h.html#19c7111cf2121a69331d99dabe3e9df0">os_start()</a>. <br>
 <br>
 <div class="fragment"><pre class="fragment"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {
  <span class="comment">/* Setup ports, clock... */</span>
  system_init();
  
  <span class="comment">/* Create kernel objects */</span>
  <a class="code" href="os__appl_a_p_i_8h.html#0dd35dda08098d9f347d34e597d8a03e">task_create</a>( myTaskProc, 1, NULL, 0 );
  mySem = <a class="code" href="os__appl_a_p_i_8h.html#aecd95706696b8ff18d5ef74d139d750">sem_bin_create</a>( 1 );
  
  <a class="code" href="os__appl_a_p_i_8h.html#6cc2e63d83267ff5059bf0a76b302a09">os_init</a>();
  clock_start();
  <a class="code" href="os__appl_a_p_i_8h.html#19c7111cf2121a69331d99dabe3e9df0">os_start</a>();
  
  <span class="comment">/* Will never end up here */</span>
  <span class="keywordflow">return</span> 0;
}
</pre></div><p>
This is the preferred order of initialization. It is crucial that the clock is not started before the tasks are created and the kernel is initialized.<p>
<b>Time </b><br>
 cocoOS keeps track of time by counting ticks. You must feed the counting with a call to <a class="el" href="os__appl_a_p_i_8h.html#1d7bc0554f6b515785211dd2c3f2d3d9">os_tick()</a> periodically from the clock tick ISR.<p>
<b>Tasks </b><br>
 An application is built up by a number of tasks. Each task is a associated with a (preferably short) procedure with a well defined purpose. The execution of the tasks, is managed by the os kernel, by letting the highest priority task among all execution ready tasks to execute. All tasks have to make at least one blocking call to a sheduling kernel function. This gives lower priority tasks a chance to execute.<p>
The task procedure must enclose its code with the <a class="el" href="os__appl_a_p_i_8h.html#c19d6a48c1cb673360ae220aaf2a9d53">task_open()</a> and <a class="el" href="os__appl_a_p_i_8h.html#7912af19af4a033fd9caf27879614945">task_close()</a> macros, as shown below.<p>
<div class="fragment"><pre class="fragment"><span class="keyword">static</span> <span class="keywordtype">void</span> task(<span class="keywordtype">void</span>) {
  <a class="code" href="os__appl_a_p_i_8h.html#c19d6a48c1cb673360ae220aaf2a9d53">task_open</a>();
  ...
  ...
  <a class="code" href="os__appl_a_p_i_8h.html#7912af19af4a033fd9caf27879614945">task_close</a>();
}
</pre></div><p>
Such a task will be executed once only. If a task is intended to be executed "for ever", an endless loop must be implemented.<p>
<div class="fragment"><pre class="fragment"><span class="keyword">static</span> <span class="keywordtype">void</span> hello_task(<span class="keywordtype">void</span>) {
  <a class="code" href="os__appl_a_p_i_8h.html#c19d6a48c1cb673360ae220aaf2a9d53">task_open</a>();
    <span class="keywordflow">for</span>(;;) {
      uart_send_string(<span class="stringliteral">"Hello World!"</span>);
      <a class="code" href="os__appl_a_p_i_8h.html#d8232a672a6d4f3a4532bea410a0b1ef">task_wait</a>( 20 );
    }
  <a class="code" href="os__appl_a_p_i_8h.html#7912af19af4a033fd9caf27879614945">task_close</a>();
}



<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {
  <span class="comment">/* Setup ports, clock... */</span>
  system_init();
  
  <span class="comment">/* Create kernel objects */</span>
  <a class="code" href="os__appl_a_p_i_8h.html#0dd35dda08098d9f347d34e597d8a03e">task_create</a>( hello_task, 1, NULL, 0 );
  
  <a class="code" href="os__appl_a_p_i_8h.html#6cc2e63d83267ff5059bf0a76b302a09">os_init</a>();
  clock_start();
  <a class="code" href="os__appl_a_p_i_8h.html#19c7111cf2121a69331d99dabe3e9df0">os_start</a>();
  
  <span class="comment">/* Will never end up here */</span>
  <span class="keywordflow">return</span> 0;
}
</pre></div><p>
<b>Scheduling</b> When a task has finished it gives the CPU control to another task by calling one of the scheduling macros:<p>
<ul>
<li><a class="el" href="os__appl_a_p_i_8h.html#d8232a672a6d4f3a4532bea410a0b1ef">task_wait()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#576b2326d068ab852846ee612c7b954c">event_wait()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#148bf0f2ab640ccf1cf29229d61defb6">event_wait_multiple()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#194e9ed0f676ffc46a782754b58a0475">event_signal()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#b14d890b777d3b2a9e4c83a3ec15dd31">sem_wait()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#a5011c236fb03784283e6476e9ae5adb">sem_signal()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#e66288422355db64c18c53676e53eddb">msg_q_get()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#dc67691f29549315143cc60ff43e2306">msg_q_give()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#24a1c276cfb77f61f43fdd74308ad4b9">msg_q_event_wait()</a> </li></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Nov 14 20:00:25 2010 for cocoOS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
