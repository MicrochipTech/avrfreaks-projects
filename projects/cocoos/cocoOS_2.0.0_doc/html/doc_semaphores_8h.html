<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>cocoOS: docSemaphores.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>docSemaphores.h File Reference</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
cocoOS supports binary and counting semaphores. A semaphore is created in the main function using one of the create functions: <a class="el" href="os__appl_a_p_i_8h.html#aecd95706696b8ff18d5ef74d139d750">sem_bin_create()</a> or <a class="el" href="os__appl_a_p_i_8h.html#9cfb5b3cc72fdaed17009a0cae7fd725">sem_counting_create()</a>. <div class="fragment"><pre class="fragment">Sem_t bin_sem;
Sem_t count_sem;

<span class="keywordtype">int</span> main( <span class="keywordtype">void</span> ) {
    bin_sem = <a class="code" href="os__appl_a_p_i_8h.html#aecd95706696b8ff18d5ef74d139d750">sem_bin_create</a>( initValue );
    count_sem = <a class="code" href="os__appl_a_p_i_8h.html#9cfb5b3cc72fdaed17009a0cae7fd725">sem_counting_create</a>( maxCount, initValue );
    ...
}
</pre></div> <em>initValue</em> is the initial value for the semaphore counter. For a binary semaphore this can be 0 or 1, and for the counting semaphore 0-255. <br>
<p>
<em>maxCount</em> is the maximum value the counting semaphore can reach. <br>
<p>
A call to <a class="el" href="os__appl_a_p_i_8h.html#b14d890b777d3b2a9e4c83a3ec15dd31">sem_wait()</a> decrements the semaphore value by one if it is not 0. If it is 0, the value is not decremented, but the task is put into the waiting state. <br>
<p>
A call to <a class="el" href="os__appl_a_p_i_8h.html#a5011c236fb03784283e6476e9ae5adb">sem_signal()</a> increments the semaphore value by one if it is not 1 in case of a binary semaphore, or maxCount in case of a counting semaphore. The semaphore is only incremented if no tasks are waiting for the semaphore. If there are a waiting task, the semaphore value is left unchanged and the highest priority waiting task gets the semaphore and is put back to ready state again. <br>
 <br>
 <b> Task Synchronization Example </b> <br>
 <br>
 In the example below, sem is a semaphore initialized with value 0. Task1 has higher priority than Task2. Task 1 will execute down to the <a class="el" href="os__appl_a_p_i_8h.html#b14d890b777d3b2a9e4c83a3ec15dd31">sem_wait( sem )</a> call, where it will block because the semaphore value is 0. Then Task2 is scheduled to execute, and will run down to the line where the semaphore is signaled. This will cause the Task2 to block, and Task1 is scheduled to execute due to its higher priority. <div class="fragment"><pre class="fragment"><span class="keyword">static</span> <span class="keywordtype">void</span> task1( <span class="keywordtype">void</span> ) {
  <a class="code" href="os__appl_a_p_i_8h.html#c19d6a48c1cb673360ae220aaf2a9d53">task_open</a>();  
  <span class="keywordflow">for</span> (;;) {
    ...
    <a class="code" href="os__appl_a_p_i_8h.html#b14d890b777d3b2a9e4c83a3ec15dd31">sem_wait</a>( sem );
    ...
  }
  <a class="code" href="os__appl_a_p_i_8h.html#7912af19af4a033fd9caf27879614945">task_close</a>();
} 

<span class="keyword">static</span> <span class="keywordtype">void</span> task2( <span class="keywordtype">void</span> ) {
  <a class="code" href="os__appl_a_p_i_8h.html#c19d6a48c1cb673360ae220aaf2a9d53">task_open</a>();  
  <span class="keywordflow">for</span> (;;) {
    ...
    <a class="code" href="os__appl_a_p_i_8h.html#a5011c236fb03784283e6476e9ae5adb">sem_signal</a>( sem );
    ...
  }
  <a class="code" href="os__appl_a_p_i_8h.html#7912af19af4a033fd9caf27879614945">task_close</a>();
}
</pre></div><p>
<b>Semaphore API</b> The Semaphore API consists of the following functions and macros:<ul>
<li><a class="el" href="os__appl_a_p_i_8h.html#aecd95706696b8ff18d5ef74d139d750">sem_bin_create()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#9cfb5b3cc72fdaed17009a0cae7fd725">sem_counting_create()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#b14d890b777d3b2a9e4c83a3ec15dd31">sem_wait()</a></li><li><a class="el" href="os__appl_a_p_i_8h.html#a5011c236fb03784283e6476e9ae5adb">sem_signal()</a> </li></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sun Nov 14 20:00:25 2010 for cocoOS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
